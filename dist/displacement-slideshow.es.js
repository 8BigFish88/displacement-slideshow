import*as e from"three";import t from"gsap/TweenMax";function n(n){function i(){for(var e=0;e<arguments.length;e++)if(void 0!==arguments[e])return arguments[e]}console.log("%c Hover effect by Robin Delaporte: https://github.com/robin-dela/hover-effect ","color: #bada55; font-size: 0.8rem");var o=n.parent,r=n.displacementImage,a=n.image1,s=n.image2,f=i(n.images,[n.image1,n.image2]),l=i(n.imagesRatio,1),u=i(n.intensity1,n.intensity,1),d=i(n.intensity2,n.intensity,1),c=i(n.angle,Math.PI/4),v=i(n.angle1,c),m=i(n.angle2,3*-c),p=i(n.speedIn,n.speed,1.6),g=i(n.speedOut,n.speed,1.2),h=i(n.easing,Expo.easeOut),y=i(n.transitionDelay,3e3),x=0,w=1,F=void 0,W=void 0,H=void 0,P=null,S=null,D=null,M=null,U=null;if(o)if((f||a&&s)&&r){var V,C,R=new e.Scene,_=new e.OrthographicCamera(o.offsetWidth/-2,o.offsetWidth/2,o.offsetHeight/2,o.offsetHeight/-2,1,1e3),b=new e.WebGLRenderer({antialias:!1,alpha:!0}),z=l,I=function(){b.render(R,_)};_.position.z=1,b.setPixelRatio(2),b.setClearColor(16777215,0),b.setSize(o.offsetWidth,o.offsetHeight),o.appendChild(b.domElement),o.offsetHeight/o.offsetWidth<z?(V=1,C=o.offsetHeight/o.offsetWidth/z):(V=o.offsetWidth/o.offsetHeight*z,C=1),(M=new e.TextureLoader).crossOrigin="",(D=M.load(r,I)).magFilter=D.minFilter=e.LinearFilter,E(),F=new e.ShaderMaterial({uniforms:{intensity1:{type:"f",value:u},intensity2:{type:"f",value:d},dispFactor:{type:"f",value:0},angle1:{type:"f",value:v},angle2:{type:"f",value:m},texture1:{type:"t",value:P},texture2:{type:"t",value:S},disp:{type:"t",value:D},res:{type:"vec4",value:new e.Vector4(o.offsetWidth,o.offsetHeight,V,C)},dpr:{type:"f",value:window.devicePixelRatio}},vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",fragmentShader:"\nvarying vec2 vUv;\n\nuniform float dispFactor;\nuniform float dpr;\nuniform sampler2D disp;\n\nuniform sampler2D texture1;\nuniform sampler2D texture2;\nuniform float angle1;\nuniform float angle2;\nuniform float intensity1;\nuniform float intensity2;\nuniform vec4 res;\nuniform vec2 parent;\n\nmat2 getRotM(float angle) {\n  float s = sin(angle);\n  float c = cos(angle);\n  return mat2(c, -s, s, c);\n}\n\nvoid main() {\n  vec4 disp = texture2D(disp, vUv);\n  vec2 dispVec = vec2(disp.r, disp.g);\n\n  vec2 uv = 0.5 * gl_FragCoord.xy / (res.xy) ;\n  vec2 myUV = (uv - vec2(0.5))*res.zw + vec2(0.5);\n\n\n  vec2 distortedPosition1 = myUV + getRotM(angle1) * dispVec * intensity1 * dispFactor;\n  vec2 distortedPosition2 = myUV + getRotM(angle2) * dispVec * intensity2 * (1.0 - dispFactor);\n  vec4 _texture1 = texture2D(texture1, distortedPosition1);\n  vec4 _texture2 = texture2D(texture2, distortedPosition2);\n  gl_FragColor = mix(_texture1, _texture2, dispFactor);\n}\n",transparent:!0,opacity:1}),R=new e.Scene,H=new e.PlaneBufferGeometry(o.offsetWidth,o.offsetHeight,1),W=new e.Mesh(H,F),R.add(W),window.addEventListener("resize",function(t){o.offsetHeight/o.offsetWidth<z?(V=1,C=o.offsetHeight/o.offsetWidth/z):(V=o.offsetWidth/o.offsetHeight*z,C=1),W.material.uniforms.res.value=new e.Vector4(o.offsetWidth,o.offsetHeight,V,C),b.setSize(o.offsetWidth,o.offsetHeight),I()}),this.next=L,this.playSlideshow=function(){var e=0;return O(e),U=setInterval(function(){L(),O(e=w),E(),F.uniforms.texture1.value=P,F.uniforms.texture2.value=S,F.uniforms.dispFactor.value=0},y)},this.stopSlideshow=function(){U&&clearInterval(U)},this.previous=function(){t.to(F.uniforms.dispFactor,g,{value:0,ease:h,onUpdate:I,onComplete:I})},this.stopSlideshowWithDelay=function(){setTimeout(function(){U&&clearInterval(U)},8e3)}}else console.warn("One or more images are missing");else console.warn("Parent missing");function L(){t.to(F.uniforms.dispFactor,p,{value:1,ease:h,onUpdate:I,onComplete:I})}function O(e){x=e,w=e==f.length-1?0:e+1}function E(){P=S||M.load(f[x],I),S=M.load(f[w],I),P.magFilter=S.magFilter=e.LinearFilter,P.minFilter=S.minFilter=e.LinearFilter}}export{n as default};
//# sourceMappingURL=displacement-slideshow.es.js.map
