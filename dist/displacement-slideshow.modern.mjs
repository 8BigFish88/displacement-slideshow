import*as e from"three";import{gsap as t}from"gsap";function i(i){function n(){for(var e=0;e<arguments.length;e++)if(void 0!==arguments[e])return arguments[e]}console.log("%c Hover effect by Robin Delaporte: https://github.com/robin-dela/hover-effect ","color: #bada55; font-size: 0.8rem");var o,r=i.parent,a=i.displacementImage,s=i.image1,f=i.image2,l=n(i.images,[i.image1,i.image2]),u=n(i.imagesRatio,1),d=n(i.intensity1,i.intensity,1),m=n(i.intensity2,i.intensity,1),v=n(i.angle,Math.PI/4),p=n(i.angle1,v),c=n(i.angle2,3*-v),g=n(i.easing,"power1.inOut"),h=n(i.speedIn,i.speed,1.6),y=n(i.speedOut,i.speed,1.2),x=n(i.transitionDelay,3e3),F=0,w=1,H=void 0,W=void 0,P=null,S=null,U=[],V=null,C=null,D=null;if(!r)return void console.warn("Parent missing");if(!(l||s&&f)||!a)return void console.warn("One or more images are missing");var L=new e.Scene,M=new e.OrthographicCamera(r.offsetWidth/-2,r.offsetWidth/2,r.offsetHeight/2,r.offsetHeight/-2,1,1e3),R=new e.WebGLRenderer({antialias:!1,alpha:!0}),_=u,b=function(){R.render(L,M)};function z(){t.to(H.uniforms.dispFactor,{duration:h,value:1,ease:g,onUpdate:b,onComplete:b})}function I(e){F=e,w=e==l.length-1?0:e+1}let O,E;M.position.z=1,R.setPixelRatio(2),R.setClearColor(16777215,0),R.setSize(r.offsetWidth,r.offsetHeight),r.appendChild(R.domElement),r.offsetHeight/r.offsetWidth<_?(O=1,E=r.offsetHeight/r.offsetWidth/_):(O=r.offsetWidth/r.offsetHeight*_,E=1),(C=new e.TextureLoader).crossOrigin="",(V=C.load(a,b)).magFilter=V.minFilter=e.LinearFilter,P=S||C.load(l[F],b),S=C.load(l[w],b),P.magFilter=S.magFilter=e.LinearFilter,P.minFilter=S.minFilter=e.LinearFilter,H=new e.ShaderMaterial({uniforms:{intensity1:{type:"f",value:d},intensity2:{type:"f",value:m},dispFactor:{type:"f",value:0},angle1:{type:"f",value:p},angle2:{type:"f",value:c},texture1:{type:"t",value:P},texture2:{type:"t",value:S},disp:{type:"t",value:V},res:{type:"vec4",value:new e.Vector4(r.offsetWidth,r.offsetHeight,O,E)},dpr:{type:"f",value:window.devicePixelRatio}},vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",fragmentShader:"\nvarying vec2 vUv;\n\nuniform float dispFactor;\nuniform float dpr;\nuniform sampler2D disp;\n\nuniform sampler2D texture1;\nuniform sampler2D texture2;\nuniform float angle1;\nuniform float angle2;\nuniform float intensity1;\nuniform float intensity2;\nuniform vec4 res;\nuniform vec2 parent;\n\nmat2 getRotM(float angle) {\n  float s = sin(angle);\n  float c = cos(angle);\n  return mat2(c, -s, s, c);\n}\n\nvoid main() {\n  vec4 disp = texture2D(disp, vUv);\n  vec2 dispVec = vec2(disp.r, disp.g);\n\n  vec2 uv = 0.5 * gl_FragCoord.xy / (res.xy) ;\n  vec2 myUV = (uv - vec2(0.5))*res.zw + vec2(0.5);\n\n\n  vec2 distortedPosition1 = myUV + getRotM(angle1) * dispVec * intensity1 * dispFactor;\n  vec2 distortedPosition2 = myUV + getRotM(angle2) * dispVec * intensity2 * (1.0 - dispFactor);\n  vec4 _texture1 = texture2D(texture1, distortedPosition1);\n  vec4 _texture2 = texture2D(texture2, distortedPosition2);\n  gl_FragColor = mix(_texture1, _texture2, dispFactor);\n}\n",transparent:!0,opacity:1}),L=new e.Scene,o=new e.PlaneBufferGeometry(r.offsetWidth,r.offsetHeight,1),W=new e.Mesh(o,H),L.add(W),window.addEventListener("resize",function(t){r.offsetHeight/r.offsetWidth<_?(O=1,E=r.offsetHeight/r.offsetWidth/_):(O=r.offsetWidth/r.offsetHeight*_,E=1),W.material.uniforms.res.value=new e.Vector4(r.offsetWidth,r.offsetHeight,O,E),R.setSize(r.offsetWidth,r.offsetHeight),b()}),this.next=z,this.playSlideshow=function(){U=l.map((t,i)=>{const n=i==l.length-1?0:i+1;return P=S||C.load(t,b),S=C.load(l[n],b),P.magFilter=S.magFilter=e.LinearFilter,P.minFilter=S.minFilter=e.LinearFilter,{currentIndex:i,texture1:P,texture2:S}});var t=0;return I(t),D=setInterval(()=>{z(),I(t=w),S=U[t].texture2,H.uniforms.texture1.value=P=U[t].texture1,H.uniforms.texture2.value=S,H.uniforms.dispFactor.value=0},x)},this.stopSlideshow=function(){D&&clearInterval(D)},this.previous=function(){t.to(H.uniforms.dispFactor,{duration:y,value:0,ease:g,onUpdate:b,onComplete:b})}}export{i as default};
//# sourceMappingURL=displacement-slideshow.modern.mjs.map
